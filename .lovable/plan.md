
# خطة تطوير النظام المحاسبي

## الحالة العامة: ~75% مكتمل

---

## ✅ المراحل المكتملة

### المرحلة 1: قاعدة البيانات ✅
- جداول: accounts, journal_entries, journal_entry_lines, customers, suppliers, products, sales/purchase invoices, returns, payments, inventory_movements
- جداول البحث: product_categories, product_brands, product_units
- جداول المصادقة: profiles, user_roles مع enum app_role
- دوال: has_role, get_user_role, get_avg_purchase_price, get_avg_selling_price
- Triggers: إنشاء ملف شخصي تلقائي عند التسجيل

### المرحلة 2: نظام المصادقة والصلاحيات ✅
- صفحة تسجيل الدخول/إنشاء حساب (Auth.tsx)
- AuthContext مع إدارة الجلسات والأدوار
- ProtectedRoute لحماية المسارات
- RoleGuard لإخفاء عناصر حسب الدور
- 3 أدوار: admin, accountant, sales

### المرحلة 3: الصفحات والجداول ✅
- DataTable موحد مع بحث + ترتيب + صفحات + إخفاء أعمدة
- فلاتر متقدمة مخصصة لكل صفحة (حالة، تاريخ، نوع الدفع، رصيد، دور)
- جميع صفحات CRUD: مبيعات، مشتريات، مرتجعات، مدفوعات، عملاء، موردين، منتجات
- شجرة الحسابات، القيود المحاسبية، دفتر الأستاذ
- التصنيفات، وحدات القياس، الماركات
- ميزان المراجعة، قائمة الدخل، الميزانية العمومية
- إدارة المستخدمين

---

## ❌ المهام المتبقية

### المرحلة 4: لوحة التحكم بالبيانات الحقيقية (أولوية عالية)
- [ ] استبدال البيانات الثابتة (mock) ببيانات حقيقية من قاعدة البيانات
- [ ] بطاقات الملخص: إجمالي المبيعات/المشتريات/الأرباح من الفواتير الفعلية
- [ ] رسوم بيانية بالبيانات الحقيقية (مبيعات/مشتريات شهرية)
- [ ] آخر الفواتير من جدول sales_invoices
- [ ] تنبيهات المخزون من جدول products (quantity_on_hand < min_stock_level)

### المرحلة 5: صفحة الإعدادات (أولوية عالية)
- [ ] إنشاء جدول company_settings في قاعدة البيانات
- [ ] إعدادات الشركة: الاسم، الشعار، العنوان، الهاتف، الرقم الضريبي
- [ ] إعدادات مالية: العملة الافتراضية، السنة المالية
- [ ] إعدادات الفواتير: بادئة الترقيم، شروط الدفع الافتراضية
- [ ] إعدادات النظام: اللغة، المنطقة الزمنية

### المرحلة 6: صفحة التقارير (أولوية متوسطة)
- [ ] تقرير المبيعات التفصيلي (بالفترة، العميل، المنتج)
- [ ] تقرير المشتريات التفصيلي
- [ ] تقرير حركة المخزون
- [ ] تقرير أعمار الديون (العملاء والموردين)
- [ ] تقرير الأرباح والخسائر
- [ ] تصدير التقارير PDF/Excel

### المرحلة 7: تصدير البيانات (أولوية متوسطة)
- [ ] تصدير CSV/Excel/PDF موحد لجميع الجداول
- [ ] قالب PDF احترافي بالعربية مع شعار الشركة

### المرحلة 8: تحسينات أمنية (أولوية عالية)
- [ ] مراجعة شاملة لسياسات RLS
- [ ] التأكد من أن جميع الجداول محمية بشكل صحيح
- [ ] تسجيل الأحداث (audit log) للعمليات الحساسة

### المرحلة 9: تحسينات إضافية (أولوية منخفضة)
- [ ] إشعارات داخل التطبيق (تنبيهات المخزون، الفواتير المستحقة)
- [ ] الوضع المظلم (Dark Mode)
- [ ] تحسين الأداء وتحميل البيانات
- [ ] طباعة الفواتير بتصميم احترافي
